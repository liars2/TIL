사이트 신뢰성 엔지니어링 Site_Reilabillity_Engineering<br>
챕터 1. 소개
==========

## 서비스 관리를 위해 시스템 관리자를 활용하는 방법

### 시스템 관리자란?
지금까지 기업들은 복잡한 시스템을 관리하기 위해 시스템 관리자(sysadmin)를 채용
시스템 관리자들은 컴포넌트를 모아서 배포하며 관리함
서비스가 증가하면서 트래픽 및 이벤트, 업데이트도 증가하니 시스템 관리자의 규모도 커짐
시스템 관리자가 있으면 서비스 운영 및 유지보수 하는 방법을 직접 결정하는 회사라면 상대적으로 쉽게 서비스 운영이 가능.
시스템 관리자의 역할을 배우고 실험해볼 수 있는 수많은 예시가 존재하기 때문 (ex: 전문 인력의 인적자원)
다양한 도구와 소프트웨어 컴포넌트로 인해 시스템 관리자들이 미숙하더라도 충분히 시스템 운영가능

### 시스템 관리자와 제품 개발자
> 시스템 관리자 역할 및 스킬 ≠ 제품 개발자 역할 및 스킬 이므로 <br>DEV(개발), OPS(관리) 팀으로 나누었음.

하지만 DEV와 OPS 로 나누는데 단점이 2가지 존재.
### 직접비용
변경이력 관리, 이벤트 처리를 수작업에 의존하며 서비스를 운영하면 서비스와 트래픽 상승으로 팀의 규모가 커짐
팀의 규모가 커지므로 결국 큰 비용이 듬 

### 간접비용
DEV OPS 로 나누는데 비용은 소소하지만, 종종 직접비용보다 큰 비용이 발생하기도 함
두 팀의 배경지식, 동기 유발조건, 서로 다른 용어, 다른 해법 예측, 안전성 목표 수준, 목표도 다르게 생각하므로 병리학적으로 복잡하고 어려움
대부분 이런 결과는 Production 릴리즈에서 발생함
> EX) DEV는 서비스 출시 후 사용자들이 기능을 사용하는 것을 보고 싶어 함<br> OPS는 좀 더 안정적으로 운영하고 싶어 함

### 결론
각자의 관심거리를 하나로 모을 수는 없다.
서로 용어와 위험에 대한 예측이 다르므로 자신들의 이해를 기반으로 선두를 잡으려 함.
운영팀은 모든 위험에 대해 지킴이 역할을 함
- 새로 출시할 기능에 대한 리뷰에 지금까지 장애발생된 문제점을 나열
개발팀은 이런 요구에 답해 다른 방식으로 접근함
- 출시 대신 'flag 변경', '정기 업데이트', '선별적 수정' 등의 단어사용.
- 적은 수의 기능들이 출시 리뷰를 받을 수 있도록 제품 기능을 잘게 나누는 기법 등을 사용

## 사이트 관리에 대한 구글의 해법: 사이트 신뢰성 엔지니어링
소프트웨어 서비스를 공급하는데 충돌은 필연적인 요소가 아님, 구글은 다른 접근 방법인 SRE를 사용.
SRE 팀은 제품을 운영하면서 시스템 관리자가 수동으로 처리하던 일을 대신할 시스템을 개발하기 위해 소프트웨어 엔지니어를 채용

### 사이트 신뢰성 엔지니어링이란? (Site Reilabillity Engineering)
SRE이란 운영팀을 위한 소프트웨어 엔지니어를 말함.

### SRE 구성방법
50 ~ 60% 소프트웨어 엔지니어 채용 정차를 거쳐 채용된 사람들
나머지 40 ~ 50%는 소프트웨어 엔지니어링 자격 요건에 아주 근접한 사람들 (ex: 요구 기술 항목의 85~99% 만족하는 인력)
대부분 소프트웨어 엔지니어들에겐 생소하지만 SRE팀에는 유용한 기술에 능통한 사람들이다.
지금까지 두 그룹에 필요한 공통인력 유닉스 시스템 전문가와 네트워킹 OSI Layer 1 ~ 3 에 능통한 사람.
그 외엔 개발을 통해 문제를 해결할 수 있다는 신념과 재능을 SRE가 갖추어야 할 덕목으로 꼽을 수 있다.
SRE 팀 내부에선 두 그룹에 대한 업무능력의 발달 과정을 면밀하게 추적한 결과 엔지니어들의 성과에 대해 별다른 차이점을 발견할 수 없었다.
오히려 SRE팀의 배경적 차이는 여러 기술이 집약된, 독창적이면서 높은 품질의 시스템을 탄생

### 두 부류의 사람들로 구성된 팀
SRE 접근법의 결과로 구글은 두 부류의 사람들로 팀을 완성함.

##### 첫 번째 부류
- 어떤 작업을 직접 손으로 수행하는 것을 금세 싫증냄

##### 두 번째 부류
- 해결책이 복잡한 경우에도 이전까지 손으로 하던 작업을 대신할 수 있는 소프트웨어를 작성하는데 필요한 기술을 갖춰짐

### 결론
SRE팀은 기본적으로 기존의 운영팀이 수행하던 업무를 수행하지만
소프트웨어에 전문성을 지닌 엔지니어들과 선천적으로 가지고 있는, **인간의 노동력을 대체할 자동화된 소프트웨어를 설계하고 구현하려는 성향과 능력을 활용한다는 차이점**이 있음
엔지니어링을 추구하지 않으면 업무 부담이 증가해 부담을 나누기 위해 더 많은 인력이 필요하기 때문에 기하급수적으로 늘어남.
서비스가 지원되는 제품이 성공하게 되면 운영 업무에 대한 부담은 트래픽과 함께 증가해, 같은 양의 업무를 처리하기 위해 더 많은 사람들을 채용함.
이 숙명에 벗어나려면 SRE팀의 티켓, 전화 응대, 수작업 등, '운영' 업무에 최대 50%의 시간만 투입.
서비스를 안정적으로 운영 가능한 상태로 유지하기 위한 충분한 시간을 벌어주기 위함.
이 시간은 최대 상한값, 시간이 지나면서 SRE팀의 운영 부담은 최소한의 수준이 되고, 대부분 개발작업에 투입되는데
그 이유는 서비스가 문제없이 동작하며 스스로 복구한 수준이 되기 때문
우리가 원하는 것은 시스템이 자동화되는게 아니라 자동적이 되는 것이다.
시스템의 규모 변화와 새로운 기능의 등장으로 인해 SRE는 긴장을 늦출 수 없다.

### 왜 하필 50% 기준을 적용할 수 있었는가?
SRE 팀이 시간을 측정한 결과 팀이 개발작업에 투입하는 시간이 50%에 미치지 못하는 현상이 지속된다는 점을 발견
운영에 대한 부담이 개발팀에 일부 전가되거나 추가적인 운영 책임이 없음에도 새로운 팀원이 팀에 배정되는 현상이 발생한다는 것을 암시
운영과 개발 업무 사이의 균형을 의도적으로 조율함으로써 SRE가 서비스의 운영을 통해 게속해서 새로운 사실을 경험하면서도 창의적이고 자발적으로 엔지니어링에 참여할 수 있는 여력을 확보할 수 있게됨.

### SRE 접근법 장점
모든 시스템들을 운영하기 위해 필요에 따라 직접 코드를 수정함으로 SRE팀은 빠르게 혁신하고 변화를 폭넓게 수용하는 특징을 보임
상대적으로 많은 수의 인력이 필요한 운영중심의 팀에 상대적으로 저렴한 비용으로 같은 서비스를 지원할 수 있음
대신 규모를 크기에 맞춰 향상시키고 운영하고 유지하기 위해선 SRE들이 필요함.

SRE팀을 도입하면 개발과 운영의 분리로 인한 부작용 회피 뿐만 아닌 두 팀의 손쉬운 업무 전환을 허용함으로써 제품 개발팀과 전체 구성원들이 두 분야를 모두 학습할 수 있게 되었고 
결과적으로 개발자들의 성장에도 도움이 됨.

## SRE 신조
SRE팀은 밑에 있는 항목에 대해 책임을 진다.
- 가용성(availiable)
- 응답 시간(latency)
- 성능(performance)
- 효율성(efficiently)
- 변화 관리(change management)
- 모니터링(monitering)
- 위기 대응(emergency response)
- 수용량 계획(capacity planning)

### 지속적으로 엔지니어링에 집중하라
앞서 말했듯이 50%에 운영업무에 시간을 투자한다고 했다, 그럼 나머지 50%는 무엇에 쓰는가?
나머지 50%는 코딩 기술을 통하여 프로젝트 업무를 수행해야 한다.

SRE가 운영 업무에 집중할 떄는 업무를 교대하기까지 8~12시간 까지 최대 두건의 업무를 담당해야한다.
그러면 업무를 정홛하고 신속하게 처리한 후, 포스트 모덤 까지 작성하기까지 충분한 시간을 확보할 수 있다.
만약 두건 이상일 경우엔 문제점을 충분히 관찰하지 못하므로 해결 과정 해결을 경험하고 배울 기회를 놓침

모든 장애에 대해서는 알림 여부를 떠나 반드시 포스트모텀을 작성해야 한다.
알림을 발생시키지 않은 건에 대한 포스트모텀이 더 중요한 이유는 모니터링되지 않고 있는 부분을 알 수 있기 때문이다.
해당 장애에 대한 조사를 통해 발생한 현상에 상세한 내용과, 발견된 모든 원인, 문제를 해결거나 개선하기 위해 했던 행동, 다시 같은 문제기 발생했을 때의 대응 방안을 도출 해야만 한다.

특정인을 비난하기보다는 실수를 공유함으로써 엔지니어가 자신의 단점을 피하거나 숨기려 하지 않고 스스로 고쳐나갈 수 있도록 유도한다.

### 서비스의 안정성을 유지하면서 변화를 최대한 수용한다
제품 개발팀과 SRE팀은 각자의 목표를 달성하는 과정에서 발생하는 구조적 충돌을 해소해 나가면서 생산적안 관계를 유지할 수 있다.
구조적 충돌(structural conflict)이란 혁신의 속도와 제품의 안정성 사이에서 발생한다.
이런 충돌을 표면으로 들어내고 이를 해결하기 위해 **에러 예산**이라는 개념을 도입했다.

에러 예산은 **신뢰성 목표를 100%로 설정하는 것은 잘못된 목표 설정** 이라는 관찰 결과에서 유래된 것이다.
어떤 소프트웨어, 시스템이든 신뢰성 100% 라는 건 올바르지 않는데. 그 이유는 시스템이 100% 가용될 때와 99.999% 가용할 때의 차이점을 설명하지 못하기 때문이다.
사용자와 서비스 간에는 매우 다양한 경로의 시스템들이 존재한다, 이런 시스템들의 가용성은 99.999%에 미치지 못한다.
따라서 99.999%와 100% 사이의 미세한 차이는 다른 시스템의 불가용성 때문에 사라진다.

목표가 설정되면 에러 예산은 1에서 목표 가용성을 뺀 값이다. 즉, 서비스의 목표 가용성이 99.99%라면 불가용한 상태인 경우는 0.01%에 해당한다.
필연적으로 발생할 수밖에 없는 0.01%의 불가용성이 서비스의 **에러 예산**이다.
SRE팀은 이 에러 예산을 초과하지 않는 범위 내에서 얼마든지 자유롭게 예산을 활용할 수 있다.

이 에러 예산을 사용하는 활용할 수 있는 방법은 개발팀이 새로운 기술을 출시하려 사용자를 확보하려고 할때
SRE가 새로운 기능들을 빠르게 출시하기 위해 감수해야 할 모든 위험을 처리하는데 에러 예산을 투입하는 것이 이상적이다.

### 모니터링
최우선 수단 중 하나로, 서비스의 소유자가 계속해서 시스템의 상태와 가용성을 점검하는 것을 말한다.
모니터링의 결과는 3가지로 나눈다.

#### 알림(alerts)
어떤 문제가 발생했거나 발생하려고 할 때 상황을 개선하기 위해 사람이 즉각적으로 어떤 대응을 취해야 한다는 것을 알린다.

#### 티켓(ticket)
사람의 대응이 필요하지만 즉각적인 대응이 필요하지는 않은 상황을 의미함
시스템이 자동으로 문제를 해결항 수는 없지만, 사람이 며칠 내로 대응하면 특별한 문제가 없는 경우다.

#### 로깅(logging)
누군가 이 정보를 반드시 확인해야 할 필요는 없지만 향후 분석이다 조사를 위해 기록되는 내용이다.
긴급한 연락을 받기 전까지는 굳이 이 로그를 읽어볼 필요는 없을 것이다.

### 긴급대응
신뢰성이란 어떤 기능에 문제가 발생하기 전에 정상적으로 동작했던 평균 시간과 평균 수리 시간을 의미한다
긴급대응의 효율성을 가장 잘 표현한 수치는 대응팀이 시스템을 정상으로 복구하는데 소요시간인 MTTR이다.

사람이 개입하면 시간이 지연됨, 실절적인 장애가 더 많이 발생하는 한이 있더라도, 사람의 개입이 필요로 하지 않는 시스템은 필요한 시스템보다 더 높은 가용성을 제공함.
절대적으로 사람의 개입이 필요한 경우, 대응책을 생각하고 행동 지침 문서에 해당 내용을 기록하는 과정에서 시스템이 직접 처리하는 경우 대비 MTTR이 세 배 이상 증가하는 것을 확인 함.

### 변화 관리
대략 70% 정도의 장애 상황이 서비스 중인 시스템의 변화 때문에 발생한다는 점을 발견했음
이 부분에 관한 모범 사례는 자동화를 통해 다음과 같은 것들을 이루어 내는 것.
- 제품의 단계적 출시
- 문제를 빠르고 정확하게 도출하기
- 문제 발생시 안전하게 이전 버전으로 되돌리기

이 3가지가 갖춰지면 사용자와 운영팀 모두 문제를 겪게되는 상황을 효과적으로 최소화 시킬 수 있음

### 수요 예측과 수용 계획
수요 예측과 수용 계획은 미래의 수요를 대비하고 필요한 가용성을 제공할 수 있는 충분한 수용력과 여력을 확보하기 위한 것이다.
상당수의 서비스와 팀들이 필요한 수용력을 적절한 시점에 확보하기 위한 과정을 준비하고 있지 않음

수용 계획은 이 두가지를 모두 고려해야 한다.
- 자연적 성장
  사용자가 제품을 채택하고 활용하면서 생겨나는 것
- 인위적 성장
  새로운 기능의 출시, 마케팅 혹은 사업부가 주도하는 다른 변화들의 결과로 생겨나는 것

수용 계획에는 다음과 같은 단계들이 반드시 고려되어야 한다.
- 자연적 수요에 대한 정확한 예측
  필요한 수용력을 확보하기까지의 시간에 대한 예측을 이끌어낼 수 있다
- 자연적 수요와 인이적 수요를 정확하게 합산하기
- 원천적인 수용력(서버, 디스크등)을 바탕으로 서비스의 수용력을 측정하기 위한 통상의 시스템 부하 테스트

수용력은 가용성에 중요한 영향을 미치므로 SRE팀은 반드시 SRE팀은 반드시 수용 계획을 세워야 하며, 프로비저닝 역시 반드시 수행해야 한다.

### 프로비저닝
프로비저닝은 변화 관리와 수용 계획을 합한 개념이다.
수용 계획은 비용이 많이 소모되므로 꼭 필요한 시점에 프로비저닝을 빠르게 사용해야한다.

### 효율성과 성능
서비스가 비용에 민감한 상황에서는 자원의 효율적인 활용은 가장 중요하게 고려해야 할 점이다.
자원의 활용이란 주어진 서비스를 배치하고 운영하는 방법이다.
서비스를 위해 세심하고 수립된 프로비저닝 전략에 의해 결정되므로 서비스에 전체에 큰 영향을 미친다.