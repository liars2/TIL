모니터링
=========

모놀리식 시스템에서는 에러가 나면 한 곳만 보면 됬다. 단일 장애 지점이기 때문에 서버는 뻗지만, 어디서 문제가 있는지 한 곳만 보면 되니까 분석이 굉장히 쉽다.

하지만 마이크로서비스는 다양한 서비스를 쪼개고, 단일 장애 지점이 아닌 한 서비스가 종료되도 지속적으로 운영할 수 있는 구조이기 때문에 서버에 장애가 발생하였을 때 장애를 해결하기에 봐야할 서비스가 한 두개가 아니다. 마이크로서비스의 장애를 분석하기 좋은 방법은 여러가지가 있지만, 가장 보편적이고 가장 먼저 찾는 로그를 제공하는 것. 모니터링에 대해 설명하는 글이다.

### 로그

    로그파일은 운영 체제나 혹은 통신 소프트웨어 간의 메시지를 기록한 파일이다.

서비스 운영별 신경써야 할 모니터링 관리
---------------------------------------

### 단일 서비스, 단일 서버

    한 서버의 한 가지 서비스만 운영한다는 것은, 한가지 로그만 보면 된다.
    하지만, 이 로그도 3년이 지나면 필요없는 로그가 된다. 1년만 지나도 가치 없는 로그가 되므로..
    그래서 주기적으로 로그를 지워야 하는데, 일일히 사용자가 로그 생성 날짜를 보고 지울 필요없이 따로 지원하는 프로그램이 있다.

#### 로그 주기(週期)

    로그는 점진적으로 쌓여만 간다, 3년전 로그 덕에 디스크 공간을 다 채워지게는 냅둘 순 없을 것이다.
    그래서 로그는 일정 주기마다 지워야 하는데, logrotate등 여러가지 지원하는 프로그램이 있다.

### 단일 서비스, 다수 서버

    한 가지 서비스여도, 서버단위로 로그 파일이 생긴다.
    모든것을 모니터링하고 보고 싶어하는데 수 많은 서버들을 봐야하는가?

지금은 수 많은 서버의 로그를 보는 것이 아닌 문제의 로그를 봐야 하는 시점이다. 호스트 레벨의 측정지표를 알아야 하는데 그러기 위해서는 모든 것을 취합(聚合)하고 세부 분석을 할 수 있어야 한다.

그렇기 위해서 호스트 그룹으로 나누어 관리하듯이 애플리케이션도 유사하게 적용하기에 충분 할 것이다.

하지만, 더욱 더 걱정되는 것은 로그파일인데, 서버가 30개라고 가정했을 때 해당 로그 파일을 얻기위해서 30개를 하나씩 로그인해서 해당 로그 파일 경로를 찾아가 로그를 다운 받는 행위를 30번 정도 반복하면 그에 따른 인력 손해가 막심할 것이다.

그래서 SSH 멀티플랙서와 같은 도구를 사용하여 로그를 볼 수 있다. (`grep 'Error' || cat foo/bar/logs/*.log`)

응답 시간 추적과 같은 작업을 하기 위해서는 다수의 서버로 작업을 할당해주는 로드밸런서도 추적 대상이 되어야 한다.

그래서, 단일 서비스를 구동하는 다수 서버는 주의해야 할 점은 아래와 같다.

1. 다수 서버의 지표를 만들기위해 모든 것을 취합하고 세부분석 후 관리하기
2. 로드밸런서의 모니터링

### 다수 서비스 다수 서버

    올것이 왔다, 마이크로서비스의 끝판왕..


남은 리스트업들


5. A Log, another log, other log.. 끝이 없는 로그들을 필요한 것들만 수집해야한다.
6. 측정 지표 추적, 어느것이 정상 상태인지 알 기 어렵다. 원하지 않는 응답을 주었다고 알람을 울리고 사람이 직접가서 봐야할만큼 잘못된 것인가????
7. 서비스 측정지표 (SIL) 참고
8. 포풍장애
9.
