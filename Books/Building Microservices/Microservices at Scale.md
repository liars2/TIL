대규모 마이크로서비스
======================

이때 까지 앞장에서 다룬 대다수의 내용들은 작은 마이크로서비스에 한해서 이야기를 나누었다.
사람 수 보다 많은 대규모의 마이크로서비스는 어떻게 관리해야하나?

밑의 있는 대부분의 내용은 [분산 컨퓨팅의 잘못된 믿음들과](https://en.wikipedia.org/wiki/Fallacies_of_distributed_computing) 매우 관련이 있습니다. 하이퍼링크에 있는 내용을 보신다면 더욱 더 쉽게 내용을 이해할 수 있습니다.

확장
---------

    범위, 규모, 세력 따위를 늘려나가는 것
    서비스의 Scope, Scale을 늘려가기 위해서는 많은 노력들이 필요하다.

### 과연 그게 높은 성능을 수용할 만한것인가?

    대규모 서비스를 운영하다 보면 그것이 과연 높은 가용성이며, 많은 자원을 사용하는 서비스인지에 결정하여 사양을 조정할 수 있다.
    이것을 어떻게 고민하곘는가?

물론, 증가하는 부하나 개별 노드의 고장에도 반응할 수 있는 **자동 확장 시스템이** 있다면 멋진일이지만

한 달에 겨우 두 번 실행하고 하루 이틀 동안 다운되는 것이 그다지 대수롭지 않는 리포팅 시스템에는 과도하다.

얼마나 많은 장애를 감내할 수 있는지와 얼마나 빠른 시스템이 되어야 하는지 아는 것은 시스템 사용자에 의해 좌우되며 다음 요구사항을 이해해야 한다.

1. 가용성
2. 서비스의 최소한의 응답 및 지연시간
3. 데이터의 내구성

### 실패를 당연시 여겨라

    비싼 하드웨어를 사용하는 서비스도 어떠한 상황에서 망가질 수 있다.
    장애는 대규모 환경에서 통계적으로 필연이다.

실패의 가능성을 수용하는 편은 예상하지 못했던 문제를 해결하는 시간보다 예상된 문제가 훨씬 처리하기 쉽기 때문이다.

어떤 것이든 고장날 수 있다는 가정을 명심하는 것은 문제의 해결 방법을 다르게 생각하도록 만든다.

### 기능 분해



### 버퍼링.. 그리고 로딩.. 마침내 에러

    한 두 번 겪어 볼 수 있는 문제일 것이다 기껏 원하는 서비스가 나올때까지 기다렸는데 오히려 에러메시지를 출력하는 것을
    소비자들도 겪는 문제인데, 마이크로서비스 통신끼리도 이와 같은 상황이 발생한다면? 그것은 지옥이랑 다름이 없을 것이다.


#### 응답 및 지연 시간

    다양한 연산은 얼마나 오래 걸려야 할까?

증가하는 부하가 응답시간에 어떻게 영향을 주는지 이해하기 위해 각각 다른 수의 사용자로 측정하는 것은 용의할 수 있다.

> 소프트웨어는 서비스를 이용하는데 예상 처리 시간이 얼마나 걸릴지 말할 수 있어야 한다.




이와 같은 문제를 해결하는 방법은 2가지 방법이 있다.

##### 타임아웃

    간과하기 쉽지만 하위 시스템에서 올바르게 사용되는 것이 중요하다.
    하위 시스템이 실제로 다운될 때까지 얼마나 오래 기다릴 수 있을까?

호출이 실패했다고 판단하는 데 너무 오래 걸리면 전체 시스템이 느려질 수 있고, 너무 빨리 타임아웃하면 호출을 실패로 고려할 것이다.

또 타임아웃이 전혀 없다면 하위시스템이 다운되어 전체 시스템이 중단될 수 있다.

> 모든 프로세스 경계 외부의 호출에 타임아웃을 넣고 항상 기본 타임아웃 시간을 설정하라.
> 타임 아웃 발생 시간을 로깅하고 어떤일이 발생했는지 살펴보며 타임아웃을 적절히 변경하라.

##### 회로 차단기

    가정마다 전력 급등으로부터 가전 기기를 보호하기 위해서 회로 차단기가 있다
    마찬가지로 서비스 간의 급등으로부터 사전에 차단을 하는 것이다
